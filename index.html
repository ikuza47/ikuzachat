<!DOCTYPE html>
<html lang="ru" class="bg-black text-gray-100">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title id="pageTitle">IkuzaChat - Настройки</title>
    <link rel="stylesheet" href="src/output.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            min-height: 100vh;
            padding: 20px;
            background: #0a0a0a;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
        }
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            text-align: center;
            margin-bottom: 30px;
        }
        .logo {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
        }
        .logo img {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            border: 1px solid #4f46e5;
        }
        .logo h1 {
            font-size: 1.8rem;
            color: #6366f1;
            font-weight: 600;
        }
        .lang-selector {
            background: #1f2937;
            border: 1px solid #262626;
            border-radius: 6px;
            padding: 8px 12px;
            color: #e5e7eb;
            cursor: pointer;
        }
        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            border-bottom: 1px solid #262626;
        }
        .tab {
            padding: 10px 16px;
            cursor: pointer;
            border-radius: 6px;
            color: #9ca3af;
            transition: all 0.2s;
        }
        .tab.active {
            background: #171717;
            color: #6366f1;
        }
        .tab:hover {
            background: #1f2937;
        }
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }
        .card {
            background: #0f0f0f;
            border: 1px solid #262626;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
        }
        .setting-item {
            margin-bottom: 20px;
        }
        .setting-label {
            display: block;
            color: #e5e7eb;
            font-size: 0.9rem;
            margin-bottom: 6px;
        }
        .setting-description {
            color: #9ca3af;
            font-size: 0.8rem;
            margin-top: 4px;
        }
        .input-field {
            width: 100%;
            padding: 10px 14px;
            background: #111;
            border: 1px solid #262626;
            border-radius: 6px;
            color: #e5e7eb;
            font-size: 0.9rem;
        }
        .input-field:focus {
            outline: none;
            border-color: #6366f1;
        }
        .btn {
            padding: 10px 16px;
            border-radius: 6px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
        }
        .btn-primary {
            background: #4f46e5;
            color: white;
        }
        .btn-primary:hover {
            background: #4338ca;
        }
        .btn-secondary {
            background: #374151;
            color: white;
        }
        .btn-secondary:hover {
            background: #1f2937;
        }
        .footer {
            margin-top: 30px;
            padding: 15px;
            background: #0a0a0a;
            border: 1px solid #262626;
            border-radius: 8px;
        }
        .code-block {
            background: #0d0d0d;
            border: 1px solid #262626;
            border-radius: 6px;
            padding: 12px;
            font-family: 'Inter', sans-serif;
            font-size: 0.9rem;
            overflow-x: auto;
        }

        /* Кастомный checkbox */
        .custom-checkbox {
            position: relative;
            display: inline-block;
            width: 18px;
            height: 18px;
        }
        .custom-checkbox input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        .checkmark {
            position: absolute;
            top: 0;
            left: 0;
            height: 18px;
            width: 18px;
            background-color: #111;
            border: 1px solid #374151;
            border-radius: 4px;
            transition: all 0.2s;
        }
        .custom-checkbox:hover input ~ .checkmark {
            border-color: #4b5563;
        }
        .custom-checkbox input:checked ~ .checkmark {
            background-color: #4f46e5;
            border-color: #4f46e5;
        }
        .checkmark:after {
            content: "";
            position: absolute;
            display: none;
        }
        .custom-checkbox input:checked ~ .checkmark:after {
            display: block;
        }
        .custom-checkbox .checkmark:after {
            left: 5px;
            top: 1px;
            width: 6px;
            height: 10px;
            border: solid white;
            border-width: 0 2px 2px 0;
            transform: rotate(45deg);
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Заголовок -->
        <div class="header">
            <div class="logo">
                <img src="src/logo.png" alt="IkuzaChat Logo">
                <h1 id="mainTitle">IkuzaChat</h1>
            </div>
            <select id="langSelector" class="lang-selector" onchange="changeLanguage()">
                <option value="ru">Русский</option>
                <option value="en">English</option>
            </select>
        </div>
        <p id="subtitle" class="text-gray-500 mt-2">Настройте ваш оверлей для Twitch чата</p>

        <!-- Табы -->
        <div class="tabs">
            <div class="tab active" data-tab="basic" id="tabBasic">Основное</div>
            <div class="tab" data-tab="advanced" id="tabAdvanced">Дополнительно</div>
            <div class="tab" data-tab="modules" id="tabModules">Модули</div>
        </div>

        <!-- Контент вкладок -->
        <div class="tab-content active" id="basic-tab">
            <div class="card">
                <h2 class="text-lg font-semibold text-indigo-300 mb-4" id="basicSettingsTitle">Основные настройки</h2>
                <div class="space-y-6">
                    <div class="setting-item">
                        <label class="setting-label" id="channelLabel">Имя канала</label>
                        <input id="channel" type="text" class="input-field" placeholder="Введите имя канала" value="ikuza47" onchange="updateUrl()">
                        <div class="setting-description" id="channelDesc">Введите имя Twitch-канала, с которого будет читаться чат</div>
                    </div>
                    <div class="setting-item">
                        <label class="setting-label" id="fontLabel">Шрифт</label>
                        <select id="fontFamily" class="input-field" onchange="updateUrl()">
                            <option value="'Segoe UI', sans-serif">Segoe UI</option>
                            <option value="Arial, sans-serif">Arial</option>
                            <option value="'Helvetica Neue', sans-serif">Helvetica</option>
                            <option value="'Open Sans', sans-serif">Open Sans</option>
                            <option value="'Roboto', sans-serif">Roboto</option>
                            <option value="'Inter', sans-serif">Inter</option>
                            <option value="system-ui">Системные шрифты</option>
                            <option value="custom">Другой шрифт...</option>
                        </select>
                        <input id="customFontInput" type="text" class="input-field mt-2 hidden" placeholder="Введите название шрифта" onchange="updateUrl()">
                        <div class="font-preview text-gray-500 mt-2">Пример текста</div>
                        <div class="setting-description" id="fontDesc">Выберите шрифт для отображения сообщений в чате</div>
                    </div>
                    <div class="setting-item">
                        <label class="setting-label" id="sizeLabel">Размер шрифта</label>
                        <input id="fontSize" type="number" min="12" max="36" value="24" class="input-field" onchange="updateUrl()">
                        <div class="setting-description" id="sizeDesc">Размер текста в чате в пикселях</div>
                    </div>
                </div>
            </div>
        </div>

        <div class="tab-content" id="advanced-tab">
            <div class="card">
                <h2 class="text-lg font-semibold text-indigo-300 mb-4" id="advancedSettingsTitle">Дополнительные настройки</h2>
                <div class="space-y-6">
                    <div class="setting-item">
                        <label class="setting-label" id="shadowColorLabel">Цвет тени</label>
                        <input id="shadowColor" type="color" class="w-full h-10 rounded bg-gray-800 border border-gray-700" onchange="updateUrl()">
                        <div class="setting-description" id="shadowColorDesc">Цвет тени текста для лучшей читаемости</div>
                    </div>
                    <div class="setting-item">
                        <label class="setting-label" id="shadowBlurLabel">Размытие тени</label>
                        <input id="shadowBlur" type="number" min="0" max="10" value="3" class="input-field" onchange="updateUrl()">
                        <div class="setting-description" id="shadowBlurDesc">Сила размытия тени (в пикселях)</div>
                    </div>
                    <div class="setting-item">
                        <div class="flex items-start">
                            <label class="custom-checkbox">
                                <input type="checkbox" id="showBadges" checked onchange="updateUrl()">
                                <span class="checkmark"></span>
                            </label>
                            <div class="ml-3">
                                <label class="setting-label" id="badgesLabel">Отображать бейджики</label>
                                <div class="setting-description" id="badgesDesc">Показывать бейджики модератора, подписчика и т.д.</div>
                            </div>
                        </div>
                    </div>
                    <div class="setting-item">
                        <div class="flex items-start">
                            <label class="custom-checkbox">
                                <input type="checkbox" id="autoRemove" onchange="toggleTimeout(); updateUrl();">
                                <span class="checkmark"></span>
                            </label>
                            <div class="ml-3">
                                <label class="setting-label" id="autoRemoveLabel">Автоудаление сообщений</label>
                                <div class="setting-description" id="autoRemoveDesc">Автоматически удалять старые сообщения через указанное время</div>
                            </div>
                        </div>
                        <div id="timeoutGroup" class="mt-3 hidden">
                            <label class="setting-label" id="timeoutLabel">Время до удаления (сек)</label>
                            <input id="removeTimeout" type="number" min="3" max="30" value="5" class="input-field" onchange="updateUrl()">
                            <div class="setting-description" id="timeoutDesc">Через сколько секунд удалять сообщение</div>
                        </div>
                    </div>
                    <div class="setting-item">
                        <div class="flex items-start">
                            <label class="custom-checkbox">
                                <input type="checkbox" id="clearChatOnCommand" checked onchange="updateUrl();">
                                <span class="checkmark"></span>
                            </label>
                            <div class="ml-3">
                                <label class="setting-label" id="clearChatLabel">Автоочистка чата</label>
                                <div class="setting-description" id="clearChatDesc">Чат будет очищаться при команде /clear в Twitch</div>
                            </div>
                        </div>
                    </div>
                    <div class="setting-item">
                        <div class="flex items-start">
                            <label class="custom-checkbox">
                                <input type="checkbox" id="colonEnabled" checked onchange="updateUrl();">
                                <span class="checkmark"></span>
                            </label>
                            <div class="ml-3">
                                <label class="setting-label" id="colonLabel">Добавлять двоеточие после ника</label>
                                <div class="setting-description" id="colonDesc">Добавлять : после имени пользователя в сообщениях</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="tab-content" id="modules-tab">
            <div class="card">
                <h2 class="text-lg font-semibold text-indigo-300 mb-4" id="modulesTitle">Модули</h2>
                <div class="space-y-6">
                    <!-- osu! -->
                    <div class="setting-item">
                        <div class="flex items-start">
                            <label class="custom-checkbox">
                                <input type="checkbox" id="osuModuleToggle" onchange="updateUrl();">
                                <span class="checkmark"></span>
                            </label>
                            <div class="ml-3">
                                <label class="setting-label" id="osuModuleLabel">osu! модуль</label>
                                <div class="setting-description" id="osuModuleDesc">Включает поддержку отображения информации о картах osu! по ссылке</div>
                            </div>
                        </div>
                        <div id="osuModuleSettings" class="mt-4 hidden">
                            <label class="setting-label" id="osuApiKeyLabel">osu! API ключ</label>
                            <input id="osuApiKey" type="text" class="input-field" placeholder="osu! API ключ" onchange="updateUrl()">
                            <div class="setting-description">
                                <span id="osuApiInstructionText">Ключ от osu! API v1 для получения информации о картах. </span>
                                <a href="#" id="osuApiLink" class="text-indigo-400 hover:underline" target="_blank" id="osuApiLinkText">инструкция</a>
                            </div>
                        </div>
                    </div>

                    <!-- Блокировка ботов -->
                    <div class="setting-item">
                        <div class="flex items-start">
                            <label class="custom-checkbox">
                                <input type="checkbox" id="botModuleToggle" onchange="updateUrl();">
                                <span class="checkmark"></span>
                            </label>
                            <div class="ml-3">
                                <label class="setting-label" id="botModuleLabel">Блокировка ботов</label>
                                <div class="setting-description" id="botModuleDesc">Скрывать сообщения от ботов (список загружается с GitHub)</div>
                            </div>
                        </div>
                    </div>

                    <!-- 7TV эмодзи после ника -->
                    <div class="setting-item">
                        <div class="flex items-start">
                            <label class="custom-checkbox">
                                <input type="checkbox" id="sevenTvNickModuleToggle" onchange="updateUrl();">
                                <span class="checkmark"></span>
                            </label>
                            <div class="ml-3">
                                <label class="setting-label" id="sevenTvNickModuleLabel">7TV эмодзи после ника</label>
                                <div class="setting-description" id="sevenTvNickModuleDesc">Добавляет 7TV эмодзи с названием как ник перед именем пользователя</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Кнопки -->
        <div class="flex space-x-3">
            <button class="btn btn-primary flex-1" onclick="copyUrl()" id="copyBtnText">
                <i class="fas fa-copy mr-2"></i>
                Скопировать ссылку
            </button>
            <button class="btn btn-secondary flex-1" onclick="resetSettings()" id="resetBtnText">
                <i class="fas fa-redo mr-2"></i>
                Сбросить
            </button>
        </div>

        <!-- Ссылка -->
        <div class="footer mt-6">
            <div class="code-block">
                <input id="overlayUrl" type="text" readonly class="w-full bg-transparent text-indigo-400 outline-none" value="">
            </div>
        </div>
    </div>

    <script>
        // Определение языка системы
        const userLang = navigator.language || navigator.userLanguage;
        let currentLang = userLang.startsWith('ru') ? 'ru' : 'en';
        console.log('🌐 Язык системы:', userLang, 'Выбран язык:', currentLang);

        // Языковые строки
        const translations = {
            ru: {
                title: 'IkuzaChat - Настройки',
                mainTitle: 'IkuzaChat',
                subtitle: 'Настройте ваш оверлей для Twitch чата',
                tabBasic: 'Основное',
                tabAdvanced: 'Дополнительно',
                tabModules: 'Модули',
                basicSettingsTitle: 'Основные настройки',
                channelLabel: 'Имя канала',
                channelDesc: 'Введите имя Twitch-канала, с которого будет читаться чат',
                fontLabel: 'Шрифт',
                fontDesc: 'Выберите шрифт для отображения сообщений в чате',
                sizeLabel: 'Размер шрифта',
                sizeDesc: 'Размер текста в чате в пикселях',
                advancedSettingsTitle: 'Дополнительные настройки',
                shadowColorLabel: 'Цвет тени',
                shadowColorDesc: 'Цвет тени текста для лучшей читаемости',
                shadowBlurLabel: 'Размытие тени',
                shadowBlurDesc: 'Сила размытия тени (в пикселях)',
                badgesLabel: 'Отображать бейджики',
                badgesDesc: 'Показывать бейджики модератора, подписчика и т.д.',
                autoRemoveLabel: 'Автоудаление сообщений',
                autoRemoveDesc: 'Автоматически удалять старые сообщения через указанное время',
                timeoutLabel: 'Время до удаления (сек)',
                timeoutDesc: 'Через сколько секунд удалять сообщение',
                clearChatLabel: 'Автоочистка чата',
                clearChatDesc: 'Чат будет очищаться при команде /clear в Twitch',
                colonLabel: 'Добавлять двоеточие после ника',
                colonDesc: 'Добавлять : после имени пользователя в сообщениях',
                modulesTitle: 'Модули',
                osuModuleLabel: 'osu! модуль',
                osuModuleDesc: 'Включает поддержку отображения информации о картах osu! по ссылке',
                osuApiKeyLabel: 'osu! API ключ',
                osuApiInstructionText: 'Ключ от osu! API v1 для получения информации о картах. ',
                osuApiLinkText: 'инструкция',
                botModuleLabel: 'Блокировка ботов',
                botModuleDesc: 'Скрывать сообщения от ботов (список загружается с GitHub)',
                copyBtnText: 'Скопировать ссылку',
                resetBtnText: 'Сбросить',
            },
            en: {
                title: 'IkuzaChat - Settings',
                mainTitle: 'IkuzaChat',
                subtitle: 'Configure your Twitch chat overlay',
                tabBasic: 'Basic',
                tabAdvanced: 'Advanced',
                tabModules: 'Modules',
                basicSettingsTitle: 'Basic Settings',
                channelLabel: 'Channel Name',
                channelDesc: 'Enter the name of the Twitch channel from which the chat will be read',
                fontLabel: 'Font',
                fontDesc: 'Choose a font for displaying messages in chat',
                sizeLabel: 'Font Size',
                sizeDesc: 'The size of the text in the chat in pixels',
                advancedSettingsTitle: 'Advanced Settings',
                shadowColorLabel: 'Shadow Color',
                shadowColorDesc: 'Text shadow color for better readability',
                shadowBlurLabel: 'Shadow Blur',
                shadowBlurDesc: 'Shadow blur strength (in pixels)',
                badgesLabel: 'Display Badges',
                badgesDesc: 'Show moderator, subscriber, etc. badges',
                autoRemoveLabel: 'Auto Remove Messages',
                autoRemoveDesc: 'Automatically delete old messages after a specified time',
                timeoutLabel: 'Time until deletion (sec)',
                timeoutDesc: 'How many seconds to delete the message after',
                clearChatLabel: 'Auto Clear Chat',
                clearChatDesc: 'Chat will be cleared when using /clear command in Twitch',
                colonLabel: 'Add colon after nickname',
                colonDesc: 'Add : after the username in messages',
                modulesTitle: 'Modules',
                osuModuleLabel: 'osu! module',
                osuModuleDesc: 'Enables support for displaying osu! map info from a link',
                osuApiKeyLabel: 'osu! API key',
                osuApiInstructionText: 'osu! API v1 key for getting beatmap info. ',
                osuApiLinkText: 'instruction',
                botModuleLabel: 'Block Bots',
                botModuleDesc: 'Hide messages from bots (list loaded from GitHub)',
                copyBtnText: 'Copy Link',
                resetBtnText: 'Reset',
            }
        };

        // Функция для обновления текста на странице
        function updateTexts() {
            const t = translations[currentLang];

            document.title = t.title;
            document.getElementById('mainTitle').textContent = t.mainTitle;
            document.getElementById('subtitle').textContent = t.subtitle;

            document.getElementById('tabBasic').textContent = t.tabBasic;
            document.getElementById('tabAdvanced').textContent = t.tabAdvanced;
            document.getElementById('tabModules').textContent = t.tabModules;

            document.getElementById('basicSettingsTitle').textContent = t.basicSettingsTitle;
            document.getElementById('channelLabel').textContent = t.channelLabel;
            document.getElementById('channelDesc').textContent = t.channelDesc;
            document.getElementById('fontLabel').textContent = t.fontLabel;
            document.getElementById('fontDesc').textContent = t.fontDesc;
            document.getElementById('sizeLabel').textContent = t.sizeLabel;
            document.getElementById('sizeDesc').textContent = t.sizeDesc;

            document.getElementById('advancedSettingsTitle').textContent = t.advancedSettingsTitle;
            document.getElementById('shadowColorLabel').textContent = t.shadowColorLabel;
            document.getElementById('shadowColorDesc').textContent = t.shadowColorDesc;
            document.getElementById('shadowBlurLabel').textContent = t.shadowBlurLabel;
            document.getElementById('shadowBlurDesc').textContent = t.shadowBlurDesc;
            document.getElementById('badgesLabel').textContent = t.badgesLabel;
            document.getElementById('badgesDesc').textContent = t.badgesDesc;
            document.getElementById('autoRemoveLabel').textContent = t.autoRemoveLabel;
            document.getElementById('autoRemoveDesc').textContent = t.autoRemoveDesc;
            document.getElementById('timeoutLabel').textContent = t.timeoutLabel;
            document.getElementById('timeoutDesc').textContent = t.timeoutDesc;
            document.getElementById('clearChatLabel').textContent = t.clearChatLabel;
            document.getElementById('clearChatDesc').textContent = t.clearChatDesc;
            document.getElementById('colonLabel').textContent = t.colonLabel;
            document.getElementById('colonDesc').textContent = t.colonDesc;

            document.getElementById('modulesTitle').textContent = t.modulesTitle;
            document.getElementById('osuModuleLabel').textContent = t.osuModuleLabel;
            document.getElementById('osuModuleDesc').textContent = t.osuModuleDesc;
            document.getElementById('osuApiKeyLabel').textContent = t.osuApiKeyLabel;
            document.getElementById('osuApiInstructionText').textContent = t.osuApiInstructionText;
            document.getElementById('osuApiLinkText').textContent = t.osuApiLinkText;
            document.getElementById('botModuleLabel').textContent = t.botModuleLabel;
            document.getElementById('botModuleDesc').textContent = t.botModuleDesc;

            document.getElementById('copyBtnText').innerHTML = `<i class="fas fa-copy mr-2"></i>${t.copyBtnText}`;
            document.getElementById('resetBtnText').innerHTML = `<i class="fas fa-redo mr-2"></i>${t.resetBtnText}`;
        }

        // Функция для обновления ссылки на инструкцию
        function updateInstructionLink() {
            const osuApiLink = document.getElementById('osuApiLink');
            if (currentLang === 'ru') {
                osuApiLink.href = 'https://github.com/ikuza47/ikuzachat/blob/main/public/howgetosuapiRU.md';
            } else {
                osuApiLink.href = 'https://github.com/ikuza47/ikuzachat/blob/main/public/howgetosuapiEN.md';
            }
        }

        // Функция смены языка
        function changeLanguage() {
            const langSelect = document.getElementById('langSelector');
            currentLang = langSelect.value;
            console.log('🌐 Язык изменён на:', currentLang);
            updateTexts();
            updateInstructionLink();
            updateUrl();
        }

        // Инициализация при загрузке
        function initLanguage() {
            const langSelect = document.getElementById('langSelector');
            langSelect.value = currentLang;
            updateTexts();
            updateInstructionLink();
        }

        // Переключение вкладок
        document.querySelectorAll('.tab').forEach(tab => {
            tab.addEventListener('click', () => {
                document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                tab.classList.add('active');
                const tabId = tab.getAttribute('data-tab') + '-tab';
                document.getElementById(tabId).classList.add('active');
            });
        });

        // Переключение настроек osu!
        function toggleTimeout() {
            const timeoutGroup = document.getElementById('timeoutGroup');
            if (document.getElementById('autoRemove').checked) {
                timeoutGroup.classList.remove('hidden');
            } else {
                timeoutGroup.classList.add('hidden');
            }
        }

        document.getElementById('osuModuleToggle').addEventListener('change', function() {
            const osuSettings = document.getElementById('osuModuleSettings');
            if (this.checked) {
                osuSettings.classList.remove('hidden');
            } else {
                osuSettings.classList.add('hidden');
            }
            updateUrl();
        });

        // Обработка выбора шрифта
        document.getElementById('fontFamily').addEventListener('change', function() {
            const customInput = document.getElementById('customFontInput');
            const preview = document.querySelector('.font-preview');
            if (this.value === 'custom') {
                customInput.classList.remove('hidden');
                preview.textContent = 'Введите название шрифта';
            } else {
                customInput.classList.add('hidden');
                preview.textContent = 'Пример текста';
                preview.style.fontFamily = this.value;
            }
            updateUrl();
        });

        // Обновление превью шрифта
        document.getElementById('customFontInput').addEventListener('input', function() {
            const preview = document.querySelector('.font-preview');
            preview.textContent = 'Проверка шрифта: ' + this.value;
            preview.style.fontFamily = this.value + ', sans-serif';
            updateUrl();
        });

        // Генерация ссылки
        function updateUrl() {
            const channel = document.getElementById('channel').value.trim().toLowerCase();
            if (!channel) return;

            const params = new URLSearchParams();
            params.append('channel', channel);

            let fontValue = document.getElementById('fontFamily').value;
            if (fontValue === 'custom') {
                const customFont = document.getElementById('customFontInput').value.trim();
                fontValue = customFont ? `'${customFont}', sans-serif` : 'sans-serif';
            }
            params.append('font', encodeURIComponent(fontValue));
            params.append('size', document.getElementById('fontSize').value);
            params.append('shadowColor', document.getElementById('shadowColor').value.replace('#', ''));
            params.append('shadowBlur', document.getElementById('shadowBlur').value);
            params.append('showBadges', document.getElementById('showBadges').checked);
            params.append('clearChatOnCommand', document.getElementById('clearChatOnCommand').checked);
            params.append('colon', document.getElementById('colonEnabled').checked);

            if (document.getElementById('autoRemove').checked) {
                params.append('autoRemove', 'true');
                params.append('timeout', document.getElementById('removeTimeout').value || '5');
            }

            // osu!
            if (document.getElementById('osuModuleToggle').checked) {
                const osuKey = document.getElementById('osuApiKey').value.trim();
                if (osuKey) {
                    params.append('osuapi', osuKey);
                }
            }

            // bot!
            params.append('ignorebots', document.getElementById('botModuleToggle').checked);
            // 7TV эмодзи после ника
            params.append('7tvnick', document.getElementById('sevenTvNickModuleToggle').checked);

            const url = `chat/overlay.html?${params.toString()}`;
            const fullUrl = `${window.location.origin}${window.location.pathname.substring(0, window.location.pathname.lastIndexOf('/') + 1)}${url}`;
            document.getElementById('overlayUrl').value = fullUrl;
        }

        // Копирование ссылки
        function copyUrl() {
            const input = document.getElementById('overlayUrl');
            input.select();
            document.execCommand('copy');
            alert('Ссылка скопирована!');
        }

        // Сброс настроек
        function resetSettings() {
            if (confirm('Сбросить все настройки?')) {
                document.getElementById('channel').value = 'ikuza47';
                document.getElementById('fontFamily').value = "'Segoe UI', sans-serif";
                document.getElementById('fontSize').value = '24';
                document.getElementById('shadowColor').value = '#000000';
                document.getElementById('shadowBlur').value = '3';
                document.getElementById('showBadges').checked = true;
                document.getElementById('autoRemove').checked = false;
                document.getElementById('clearChatOnCommand').checked = true;
                document.getElementById('colonEnabled').checked = true;
                document.getElementById('osuModuleToggle').checked = false;
                document.getElementById('osuApiKey').value = '';
                document.getElementById('botModuleToggle').checked = false;
                document.getElementById('customFontInput').classList.add('hidden');
                document.querySelector('.font-preview').textContent = 'Пример текста';
                document.querySelector('.font-preview').style.fontFamily = "'Segoe UI', sans-serif";
                document.getElementById('timeoutGroup').classList.add('hidden');
                document.getElementById('osuModuleSettings').classList.add('hidden');
                document.querySelector('.tab[data-tab="basic"]').click();
                updateUrl();
                alert('Настройки сброшены');
            }
        }

        // Инициализация
        document.addEventListener('DOMContentLoaded', () => {
            initLanguage();
            updateUrl();
        });
    </script>
</body>
</html>